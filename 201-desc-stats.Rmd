# データの要約 {#desc-stats}

データを読み込んで最初にすることは、データの概形を掴むことだと思います。
分析に入る前に、データがどのような特徴を持っているのか、データを作成した場合はミスをしていないかを確認するべきでしょう。

データから代表的な値を計算することでデータを要約することができます。
このような方法を**記述統計** (descriptive statistics) と呼びます。

もう一つのアプローチはグラフなどを描いて視覚的に把握することですが、これは後述します。

```{r}
library(tidyverse)
library(summarytools)
```

```{r, echo=FALSE}
library(knitr)
```

## データを見る

データを把握する最もナイーブな方法は生のデータを見ることです。
例えば、`.csv`や`.xls`ファイルであれば適当な表計算ソフトで開くことで見ることができます。
また、`View()`という関数でRに取り込んだデータを見ることもできます。

```{r}
tri <- read_csv("data/triangle.csv")
View(tri)
```

しかし、大抵の場合、観察数が多すぎてデータをそのまま見てもなんだかよく分からないことが多いです。

- データが大きすぎると開くのに時間がかかることもあります。

まずは、`head()`によって、データの冒頭だけ見るのがよいでしょう。
これによって、データの形式が想定通りか暫定的にチェックできます。

```{r}
head(tri)
```

- `tail()`を使うとデータの最後を見ることがきでます。

## 記述統計

記述統計とは変数をいくつかの指標によって表現することを言います。

### 平均

平均 (mean) は次のように定義されます。

$$
\bar{x}_i = \sum_{i=1}^n \frac{x_i}{n}
$$

Rでは、まずデータフレームから変数を抜き出し、`mean()`に入れます。

```{r}
mean(tri$smldep)
```

- ちなみに、欠損値がある場合は`NA`となるので、`na.rm = TRUE`というオプションを付けます。
- `smldep`は二国間の相互依存度を示しています。

`tidyverse`風に書くなら、次のようになります。

```{r}
tri %>% 
  pull(smldep) %>% 
  mean()
```

- `pull()`でベクトルを抜き出すことができます。

### 分散と標準偏差

分散 (variance) は次のように定義され、変数の散らばりを意味します。

$$
\sigma^2 = \sum_{i=1}^n \frac{(x - \bar{x})^2}{n}
$$

Rでは`var()`によって求めます。

- 厳密に言えば、不偏分散と呼ばれるもので、$n$の代わりに$n-1$で割られています。

```{r}
var(tri$smldep)
```

分散の平方根$\sigma$を標準偏差 (standard error) と呼び`sd()`で計算します。

```{r}
sd(tri$smldep)
```

実際に二乗すると分散と同じ値になります。

```{r}
sd(tri$smldep)^2
```

### 分位点

$q$%分位点 (quantile) とは、下から数えて$q$％に当たる点を意味します。
例えば、50%分位点は、中央値 (median) とも呼ばれ、上から見ても下から見てもちょうど真ん中に位置します。

中央値は`median()`で求めることができ、一般的に分位点は`quantile()`で求めることができます。

```{r}
median(tri$smldep)
quantile(tri$smldep, 0.5)
```

- どっちも同じであることが分かります。

`quantile()`は一度に複数の分位点を求めることができます。

```{r}
quantile(tri$smldep, c(0.25, 0.5, 0.75))
```

- 25%と75%分位点は第1四分位点、第3四分位点とも呼ばれ、中央値と共に報告されることが多いです。

### 記述統計表

通常は、特定の変数だけの記述統計を報告するということはなく、分析で使用する変数全てについて報告します。
`summary()`にデータフレームを入れると、全体の記述統計を出してくれます。

```{r}
summary(tri)
```

ただし、これをそのまま論文などに載せるのはカッコよくありません。
そこで、`summarytools`というパッケージを使います。

- データフレームにすることにこだわらないのであれば、`stargazer`というパッケージでもいいと思います。

`descr()`という関数でmarkdownのテーブル形式で表示します。

```{r}
descr(tri, transpose = TRUE)
```

その結果をさらに`tb()`に入れることで、データフレームにできるので、`.csv`ファイルなどとして書き出すこともできます。

```{r, eval=FALSE}
tri %>% 
  descr() %>% 
  tb()
```

また、`dfSummary()`と`view()`でファンシーに表示してくれます。

```{r, eval=FALSE}
tri %>% 
  dfSummary() %>% 
  summarytools::view()
```

- `summarytools::view()`としているのは、`tidyr`にも`view()`という関数があるので、`summarytools`のもであることを明示するためです。

## データのカウント

例えば、戦争が起こった・起こらなかった、のようにカテゴリカル変数の場合、上記の記述統計を用いるより、数えてしまう方が良いことがあります。
`table()`で数えることができます。

```{r}
table(tri$dispute1)
```

`table()`に複数の便数を入れることで、クロス表を作ることもできます。

```{r}
table(tri$dispute1, tri$noncontg)
```

`tidyverse`には`count()`という関数があり、数えることができます。

```{r}
tri %>% 
  count(dispute1)
tri %>% 
  count(dispute1, noncontg)
```

- `count()`の結果をクロス表にするには`pivot_wider()`を使います。

`summarytools()`であれば、`freq()`や`ctable()`を使います。

```{r}
freq(tri$dispute1)
ctable(tri$dispute1, tri$noncontg)
```

## グループごとの要約

特定のグループごとに記述統計を求めたい場合があるとします。
このような場合、`tidyverse`の`group_by()`と`summarise()`を組み合わせます。

例えば、次のようにして各年の`smldep`の平均値を求めることができます。

```{r}
tri %>% 
  group_by(year) %>% 
  summarise(mean_smldep = mean(smldep))
```

`group_by()`は`summarytools`でも使えます。
紛争が起こっているかどうかでグループ分けをします。

```{r}
tri %>% 
  group_by(dispute1) %>% 
  descr() %>% 
  tb()
```

## ユニークなデータ*
